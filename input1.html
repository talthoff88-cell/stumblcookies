<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stumbl Cookies</title>

  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>
  <script type="text/javascript">
    (function(){
      emailjs.init("YOUR_PUBLIC_KEY"); // Replace with your EmailJS public key
    })();
  </script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 1rem;
      padding-bottom: env(safe-area-inset-bottom);
      background: #faf7f3;
      color: #222;
    }

    .container {
      max-width: 420px;
      margin: 0 auto;
      background: #fff;
      padding: 1.5rem 1.25rem;
      border-radius: 16px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.06);
    }

    h1 { text-align: center; margin-bottom: 0.25rem; }
    .price { text-align: center; color: #555; margin-bottom: 1.75rem; }

    label {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      margin-bottom: 0.25rem;
      margin-top: 1.25rem;
      color: #555;
    }

    input, textarea {
      width: 100%;
      padding: 0.75rem;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-size: 1rem;
      background: #fafafa;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #8b5a2b;
      background: #fff;
    }

    .total { text-align: right; margin-top: 0.5rem; font-weight: 600; }

    button {
      width: 100%;
      margin-top: 1.75rem;
      padding: 0.9rem;
      background: #8b5a2b;
      color: white;
      border: none;
      border-radius: 14px;
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      cursor: pointer;
    }

    button:disabled { opacity: 0.7; cursor: default; }

    .ticker {
      margin-top: 2.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
      text-align: center;
    }

    .ticker h3 { font-size: 0.9rem; letter-spacing: 0.08em; margin-bottom: 0.5rem; }
    .count { font-size: 1.5rem; font-weight: 700; }

    .progress-bar {
      width: 100%;
      height: 16px;
      background-color: #eee;
      border-radius: 999px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background-color: #8b5a2b;
      width: 0%;
      transition: width 0.4s ease;
    }

    .note { font-size: 0.85rem; color: #555; line-height: 1.4; }

    /* Hidden admin button */
    #resetBtn {
      display: none;
      margin-top: 1rem;
      background: #555;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Stumbl Cookies</h1>
    <div class="price">$5 each ¬∑ $20 for 5 cookies</div>

    <label for="name">Name</label>
    <input id="name" type="text" placeholder="Your name" />

    <label for="email">Email</label>
    <input id="email" type="email" placeholder="you@email.com" />

    <label for="quantity">Quantity</label>
    <input id="quantity" type="number" value="5" min="1" />

    <div class="total">Total: $<span id="totalPrice">20</span></div>

    <label for="requests">Special Requests</label>
    <textarea id="requests" placeholder="Pickup time, allergies, etc."></textarea>

    <button id="joinBtn">JOIN NEXT BATCH</button>

    <div class="ticker">
      <h3>üî• COOKIE TICKER</h3>
      <div class="count"><span id="currentCount">0</span> / 50 cookies</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <p class="note">
        Once the ticker hits 50 cookies, a fresh batch will be made.<br />
        <em>You‚Äôll be notified when your batch is baking üç™</em>
      </p>
    </div>

    <!-- Hidden admin reset button -->
    <button id="resetBtn">Reset Batch (Admin)</button>
  </div>

  <script>
    const quantityInput = document.getElementById('quantity');
    const totalPriceEl = document.getElementById('totalPrice');
    const joinBtn = document.getElementById('joinBtn');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const requests = document.getElementById('requests');
    const currentCountEl = document.getElementById('currentCount');
    const progressFill = document.getElementById('progressFill');
    const resetBtn = document.getElementById('resetBtn');

    let currentBatchCount = 0; // start at 0
    const BATCH_SIZE = 50;
    let batchNotified = false; // tracks if 50-cookie email sent

    function calculateTotal(qty) {
      const bundles = Math.floor(qty / 5);
      const remainder = qty % 5;
      return bundles * 20 + remainder * 5;
    }

    function updateTotal() {
      const qty = parseInt(quantityInput.value || '0', 10);
      totalPriceEl.textContent = calculateTotal(qty);
    }

    function sendEmail(to_email, subject, message) {
      const templateParams = {
        to_name: to_email.includes("youremail") ? "Baker" : nameInput.value,
        to_email: to_email,
        message: message
      };

      emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", templateParams)
        .then((response) => console.log("Email sent!", response.status, response.text))
        .catch((error) => console.error("Email failed:", error));
    }

    quantityInput.addEventListener('input', updateTotal);

    joinBtn.addEventListener('click', () => {
      if (!nameInput.value || !emailInput.value) {
        alert('Please enter your name and email to join the batch.');
        return;
      }

      const qty = parseInt(quantityInput.value || '0', 10);
      const prevCount = currentBatchCount;
      currentBatchCount += qty;

      currentCountEl.textContent = currentBatchCount;

      // Customer confirmation email
      sendEmail(
        emailInput.value,
        "Your Stumbl Cookies Order Confirmation",
        `Hi ${nameInput.value},\n\nThanks for your order of ${qty} cookies!\n` +
        `Special Requests: ${requests.value || "None"}\n\n` +
        `You‚Äôre in the next batch ‚Äì you‚Äôll be notified when baking starts. üç™`
      );

      // Baker notification when batch hits 50 cookies
      if (!batchNotified && currentBatchCount >= BATCH_SIZE) {
        batchNotified = true;
        alert('üéâ Batch reached 50 cookies! Sending notification to baker...');
        sendEmail(
          "youremail@example.com",
          "Batch Ready to Bake",
          `The cookie ticker reached ${currentBatchCount} cookies. Time to start baking!`
        );
      }

      const progressPercent = Math.min((currentBatchCount / BATCH_SIZE) * 100, 100);
      progressFill.style.width = progressPercent + '%';

      joinBtn.textContent = 'ADDED TO NEXT BATCH ‚úì';
      joinBtn.disabled = true;
    });

    function resetBatch() {
      if (currentBatchCount === 0) return;

      alert(`üç™ Batch complete! ${currentBatchCount} cookies baked. Notifying customers...`);

      // Baker notification
      sendEmail(
        "youremail@example.com",
        "Batch Baking Started",
        `The batch of ${currentBatchCount} cookies is now being baked.`
      );

      currentBatchCount = 0;
      batchNotified = false;
      currentCountEl.textContent = currentBatchCount;
      progressFill.style.width = '0%';

      joinBtn.textContent = 'JOIN NEXT BATCH';
      joinBtn.disabled = false;
    }

    resetBtn.addEventListener('click', resetBatch);

    // Secret key combo: Shift + R to reveal/hide reset button
    document.addEventListener('keydown', (e) => {
      if (e.shiftKey && e.key.toLowerCase() === 'r') {
        if (resetBtn.style.display === 'none') {
          resetBtn.style.display = 'block';
          alert('üîß Admin Reset Button Revealed');
        } else {
          resetBtn.style.display = 'none';
        }
      }
    });

    updateTotal();
  </script>
</body>
</html>
